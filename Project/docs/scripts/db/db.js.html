<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: db.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: db.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
import mysql from "mysql2/promise";
import connectionOptions from "./connection-options.js";

/**
 * Executa um comando SQL na base de dados.
 * @param {string} command - O comando SQL a executar.
 * @param {Array} [parameters=[]] - Os parâmetros para o comando SQL.
 * @returns {Promise&lt;any>|undefined} - O resultado da execução do comando ou undefined em caso de erro.
 */
async function execute(command, parameters = []) {
    let connection;
    try {
        connection = await mysql.createConnection(connectionOptions);
        console.log("A executar query:", command, parameters);
        let [result] = await connection.execute(command, parameters);
        return result;
    } catch (error) {
        console.error("Erro na base de dados:", error);
        return void 0;
    } finally {
        connection?.end();
    }
}

/**
 * Converte um valor para número.
 * @param {any} value - O valor a converter.
 * @returns {number|undefined} - O número convertido ou undefined se não for um número válido.
 */
function number(value) {
    let result = Number(value);
    return isNaN(result) ? void 0 : result;
}

/**
 * Converte um valor para string.
 * @param {any} value - O valor a converter.
 * @returns {string|undefined} - A string convertida ou undefined se o valor for indefinido.
 */
function string(value) {
    return value === undefined ? void 0 : String(value);
}

/**
 * Converte um valor para uma data no formato YYYY-MM-DD.
 * @param {any} value - O valor a converter.
 * @returns {string|undefined} - A data formatada ou undefined se não for uma data válida.
 */
function date(value) {
    let result = new Date(String(value));
    return isNaN(result.getTime()) ? void 0 : result.toISOString().slice(0, 10);
}

/**
 * Converte um valor para booleano numérico (1 ou 0).
 * @param {any} value - O valor a converter.
 * @param {boolean} [forceValue=false] - Se true, retorna false em caso de valor inválido.
 * @returns {number|undefined} - 1 para verdadeiro, 0 para falso, ou undefined se não for reconhecido.
 */
function boolean(value, forceValue = false) {
    let result;
    if (typeof value === "boolean") {
        result = value;
    } else if (typeof value === "string") {
        value = value.toLowerCase();
        result = value === "true" || (value === "false" ? false : void 0);
    }
    return result === void 0 ? (forceValue ? false : void 0) : Number(result);
}

/**
 * Converte um valor para booleano verdadeiro ou falso.
 * @param {any} value - O valor a converter.
 * @returns {boolean} - O valor convertido para booleano.
 */
function toBoolean(value) {
    return Boolean(value);
}

/**
 * Envia uma resposta de erro ao cliente.
 * @param {Object} response - O objeto de resposta HTTP.
 * @param {string} [error=""] - A mensagem de erro.
 * @param {number} [status=400] - O código de estado HTTP.
 */
function sendError(response, error = "", status = 400) {
    response.status(status).end(typeof error === "string" ? error : "");
}

/**
 * Executa um comando SQL e envia a resposta ao cliente.
 * @param {Object} response - O objeto de resposta HTTP.
 * @param {string} command - O comando SQL a executar.
 * @param {Array} [parameters=[]] - Os parâmetros para o comando SQL.
 * @param {Function} [processResult] - Função opcional para processar o resultado antes de enviá-lo.
 */
async function sendResponse(response, command, parameters, processResult) {
    let result = await execute(command, parameters);
    if (result) {
        response.json(result);
    } else {
        sendError(response, "", 500);
    }
}

export { execute, number, string, date, boolean, toBoolean, sendError, sendResponse };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#boolean">boolean</a></li><li><a href="global.html#date">date</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#number">number</a></li><li><a href="global.html#sendError">sendError</a></li><li><a href="global.html#sendResponse">sendResponse</a></li><li><a href="global.html#string">string</a></li><li><a href="global.html#toBoolean">toBoolean</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri Feb 21 2025 22:13:40 GMT+0000 (Hora padrão da Europa Ocidental)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
